ImageLoader=function(a){casual.EventDispatcher.call(this);a&&this._addSource(a);this._loaded=-1;this.isLoading=!1;this._images=[];this._totalSize=0};casual.inherit(ImageLoader,casual.EventDispatcher);ImageLoader.prototype.load=function(a){a&&this._addSource(a);this.isLoading||this._loadNext()};ImageLoader.prototype._addSource=function(a){a=a instanceof Array?a:[a];for(var b=0;b<a.length;b++)this._totalSize+=a[b].size||0;this._source=this._source?this._source.concat(a):a};
ImageLoader.prototype._loadNext=function(){this._loaded++;if(this._loaded>=this._source.length)this.dispatchEvent({type:"complete",target:this,images:this._images}),this._source=[],this.isLoading=!1;else{var a=new Image;a.onload=casual.delegate(this._loadHandler,this);a.src=this._source[this._loaded].src;this.isLoading=!0}};ImageLoader.prototype._loadHandler=function(a){var b=this._source[this._loaded];b.image=a.target;this._images.push(b);this.dispatchEvent({type:"loaded",target:this,image:b});this._loadNext()};
ImageLoader.prototype.getLoaded=function(){return this._images.length};ImageLoader.prototype.getTotal=function(){return this._source.length};ImageLoader.prototype.getLoadedSize=function(){for(var a=0,b=0;b<this._images.length;b++)a+=this._images[b].size||0;return a};ImageLoader.prototype.getTotalSize=function(){return this._totalSize};
