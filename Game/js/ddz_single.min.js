ddz.initSingleGame = function () {
    this.bgContext.globalAlpha = 1;
    this.setBackground(R.mainbg);
    var b = R.toolbar;
    b.x = this.width - b.width >> 1;
    b.y = -2;
    b._render(this.bgContext);
    b = this.createCanvas("info", {width: this.width, height: this.height - 100});
    this.infoStage = new Stage(b.getContext("2d"));
    this.infoStage.setFrameRate(0);
    this.infoStage.usePixelTrace = !1;
    this.container.appendChild(b);
    this.infoStage.addEventListener("mousedown", function (a) {
        ddz.removeNavBar();
        a.target && "exit" == a.target.name || UI.showPopup(!1)
    });
    this.infoStage.addChild(UI.toolbar.container);
    b = this.createCanvas("poker", {width: this.width, height: 100, top: this.height - 100});
    this.pokerStage = new Stage(b.getContext("2d"));
    this.pokerStage.setFrameRate(0);
    this.pokerStage.usePixelTrace = !1;
    this.container.appendChild(b);
    this.isSwiping = !1;
    this.swipePokers = [];
    this.pokerStage.addEventListener("mousedown", casual.delegate(this.pokerHandler, this));
    this.pokerStage.addEventListener("mousemove", casual.delegate(this.pokerHandler, this));
    this.pokerStage.addEventListener("mouseup", casual.delegate(this.pokerHandler,
        this));
    b = this.createCanvas("control", {width: this.width - 100, height: 45, left: 50, top: this.height - 150});
    this.controlStage = new Stage(b.getContext("2d"));
    this.controlStage.setFrameRate(0);
    this.controlStage.usePixelTrace = !1;
    this.container.appendChild(b);
    this.playerStage.removeAllChildren();
    this.initSinglePlayers();
    this.playerStage.render();
    b = UI.startBtn;
    b.x = this.controlStage.getStageWidth() - b.width >> 1;
    this.controlStage.addChild(b);
    b.fastRender(this.controlStage.context);
    b.onMouseUp = function (a) {
        this.fastClear();
        setTimeout(casual.delegate(ddz.startSingleGame, ddz), 1E3)
    }
};
ddz.pokerHandler = function (b) {
    switch (b.type) {
        case "mousedown":
            this.isSwiping = !0;
            this.swipePokers.length = 0;
            if ((b = this.pokerStage.getObjectUnderPoint(b.mouseX, b.mouseY, !1)) && b instanceof Poker) {
                var a = this.user.pokers.indexOf(b);
                this.swipePokers.start = this.swipePokers.end = a;
                this.swipePokers.push(b)
            }
            break;
        case "mouseup":
            this.isSwiping = !1;
            if (0 < this.swipePokers.length) {
                for (a = 0; a < this.swipePokers.length; a++) {
                    var c = this.swipePokers[a];
                    Poker.select(c, !c.selected);
                    c.setMask(!1)
                }
                this.pokerStage.render();
                this.swipePokers.start = -1;
                this.swipePokers.end = -1;
                this.swipePokers.length = 0
            }
            break;
        case "mousemove":
            if (!this.isSwiping)break;
            if ((b = this.pokerStage.getObjectUnderPoint(b.mouseX, b.mouseY, !1)) && b instanceof Poker) {
                a = this.user.pokers.indexOf(b);
                b = this.swipePokers.start;
                var d = this.swipePokers.end;
                if (a == d && a != b)break;
                0 > b && (b = a);
                var d = a, f = b, g = d;
                b > d && (f = d, g = b);
                for (a = f; a <= g; a++)c = this.user.pokers[a], -1 == this.swipePokers.indexOf(c) && this.swipePokers.push(c);
                for (a = 0; a < this.swipePokers.length; a++) {
                    var c = this.swipePokers[a], e = this.user.pokers.indexOf(c);
                    e < f || e > g ? (c.setMask(!1), this.swipePokers.splice(a, 1), a--) : c.setMask(!0)
                }
                this.swipePokers.start = b;
                this.swipePokers.end = d;
                this.pokerStage.render()
            }
    }
};
ddz.resetGame = function () {
    this.clearGambleStage();
    this.infoStage.clear();
    this.infoStage.removeAllChildren();
    this.pokerStage.clear();
    this.pokerStage.removeAllChildren();
    this.playerStage.clear();
    UI.toolbar.lastPokers.removeAllChildren();
    UI.bubble && UI.bubble.parent && UI.bubble.parent.removeChild(UI.bubble);
    Player.glow && Player.glow.parent && Player.glow.parent.removeChild(Player.glow);
    this.dizhu && this.dizhu.setPortrait();
    for (var b = 0; b < this.players.length; b++) {
        var a = this.players[b];
        a == this.user && (a.x = this.width -
            a.width >> 1, a.y = this.height - a.height - 50, this.showText("score" + b, !0, this.user.score));
        a.reset();
        a.pokers = null;
        a.pokerCount.clear();
        this.playerStage.addChild(a);
        a.fastRender(this.playerStage.context);
        this.showText("name" + b, !0, a.name);
        this.showText("level" + b, !0, a.level.title);
        0 == b && this.showText("score0", !0, "财富:" + this.user.score, this.user.x + 5, this.top + a.y + a.height + 30, "#54eaef");
        var c;
        0 == b ? (c = R.handup, c.x = this.width - c.width >> 1, c.y = a.y - 35) : 1 == b ? (c = casual.copy(R.handup), c.x = a.x - c.width - 5, c.y = a.y + 40) : 2 ==
            b && (c = casual.copy(R.handup), c.x = a.x + a.width + c.width + 5, c.y = a.y + 40, c.scaleX = -1);
        this.infoStage.addChild(c)
    }
    UI.toolbar.container.removeChild(UI.toolbar.scoreText);
    UI.toolbar.container.removeChild(UI.toolbar.baseText);
    this.infoStage.addChild(UI.toolbar.container);
    this.infoStage.render();
    this.showControlButtons(!1);
    this.controlStage.addChild(UI.startBtn);
    UI.startBtn.fastRender(this.controlStage.context)
};
ddz.initSinglePlayers = function () {
    Player.randomData.length = 0;
    this.players = [];
    for (var b = 0; 3 > b; b++) {
        var a;
        if (0 == b) {
            a = new Player(b, Player.DEFAULT.names[0], Player.DEFAULT);
            a.setPortrait(R.playerDefault);
            a.x = this.width - a.width >> 1;
            a.y = this.height - a.height - 50;
            this.user = a;
            this.getLocalData();
            this.showText("name0", !0, a.name, this.left + a.x + 5, this.top + a.y + a.height + 1, "#fff");
            this.showText("level0", !0, a.level.title, this.left + a.x + 5, this.top + a.y + a.height + 16, "#54eaef");
            this.showText("score0", !0, "财富:" + this.user.score, this.user.x + 5, this.top + a.y + a.height + 30, "#54eaef");
            var c = R.handup;
            c.x = this.width - c.width >> 1;
            c.y = a.y - 35;
            this.infoStage.addChild(c)
        } else 1 == b ? (a = new Player(b, Player.MALE.names[0], Player.MALE), a.setPortrait(R.playerMale), a.x = this.width - a.width - 2, a.y = 2, a.level = Level.getRandom(6), a.score = a.level.score, this.showText("name1", !0, a.name, this.left + a.x + 2, this.top + a.y + a.height + 1, "#fff"), this.showText("level1", !0, a.level.title, this.left + a.x + 2, this.top + a.y + a.height + 16, "#54eaef"), c = casual.copy(R.handup), c.x = a.x -
            c.width - 5, c.y = a.y + 40, this.infoStage.addChild(c)) : 2 == b && (a = new Player(b, Player.FEMALE.names[0], Player.FEMALE), a.setPortrait(R.playerFemale), a.x = 2, a.y = 2, a.level = Level.getRandom(6), a.score = a.level.score, this.showText("name2", !0, a.name, this.left + a.x + 2, this.top + a.y + a.height + 1, "#fff"), this.showText("level2", !0, a.level.title, this.left + a.x + 2, this.top + a.y + a.height + 16, "#54eaef"), c = casual.copy(R.handup), c.x = a.x + a.width + c.width + 5, c.y = a.y + 40, c.scaleX = -1, this.infoStage.addChild(c));
        this.players[b] = a;
        this.playerStage.addChild(a)
    }
};
ddz.getLocalData = function () {
    if (this.supportStorage && localStorage.hasOwnProperty("webddz_score"))var b = Number(localStorage.getItem("webddz_score"));
    this.user.score = "undefined" != typeof Gamehub1 ? Gamehub1.Score.get() : isNaN(b) ? 0 : b;
    this.user.level = Level.getLevel(this.user.score)
};
ddz.saveLocalData = function () {
    this.supportStorage && (this.isIpad && localStorage.removeItem("webddz_score"), localStorage.setItem("webddz_score", this.user.score))
};
ddz.showText = function (b, a, c, d, f, g) {
    var e = document.getElementById(b);
    e || (e = document.createElement("span"), b && (e.id = b), e.style.position = "absolute", e.style.font = this.isMobile ? "bold 12px 黑体" : "12px 宋体", e.style.display = "inline-block", e.style.whiteSpace = "nowrap", e.style.zIndex = 10, this.isMobile && (e.style.textShadow = "1px 1px 1px #000"), e.style.MozUserSelect = "none", e.style.MozUserFocus = "ignore", e.style.MozUserInput = "disabled", e.onselectstart = function (a) {
        return!1
    }, this.container.appendChild(e));
    e.style.display =
        a ? "block" : "none";
    e.style.display && (e.style.zIndex = 10);
    void 0 != d && (e.style.left = d + "px");
    void 0 != f && (e.style.top = f + "px");
    void 0 != g && (e.style.color = g);
    e.innerHTML = c
};
ddz.startSingleGame = function () {
    trace("startSingleGame:", this.user, this.user.score, this.players[1].score, this.players[2].score);
    this.infoStage.removeAllChildren();
    this.infoStage.clear();
    this.infoStage.addChild(UI.toolbar.container);
    this.infoStage.render();
    this.user.x = 2;
    this.user.y = this.height - this.user.height - 105;
    this.playerStage.render();
    this.showText("name0", !1);
    this.showText("level0", !1);
    this.showText("score0", !0, "财富:" + this.user.score, this.user.x + 2, this.height - 105, "#54eaef");
    for (var b = Poker.shuffle(Poker.shuffle(Poker.newPack())),
             a = 0; 3 > a; a++) {
        var c = this.players[a], d = b.slice(17 * a, 17 * (a + 1));
        c != this.user && AI.sort1(d);
        c.pokers = d
    }
    c = this.pokerStage.getStageWidth() - 384 - R.pokerWidth >> 1;
    d = this.pokerStage.getStageHeight() - R.pokerHeight - 2;
    for (a = 0; 17 > a; a++) {
        var f = this.players[0].pokers[a];
        f.x = c + 24 * a;
        f.y = d;
        f.mouseEnabled = !1;
        this.pokerStage.addChild(f)
    }
    b = b.slice(51);
    setTimeout(casual.delegate(this.dealPokers, this), 100, b)
};
ddz.dealPokers = function (b) {
    var a = this.createCanvas("deal", {height: this.height - 100, top: 40}), c = new Stage(a.getContext("2d"));
    c.setFrameRate(0);
    this.container.appendChild(a);
    for (var d = 0; 6 > d; d++) {
        a = new Bitmap(R.poker, R.pokerbg.m);
        a.x = this.width - a.width >> 1;
        a.y = this.height - 260;
        a.index = d;
        c.addChild(a);
        a.visible = !0;
        a.oldx = a.x;
        a.oldy = a.y;
        var f = 2 > d ? a.x : 4 > d ? this.width - 80 : 30, g = 2 > d ? this.height - 160 : a.y, e = d % 2 * 1500 + 500 * Math.floor(d / 2);
        setTimeout(TweenUtil.to, e, a, this.playTween ? 200 : 90, {x: f, y: g, onUpdate: function () {
            this.target.fastRender(c.context)
        },
            onComplete: function () {
                5 <= this.target.index ? ddz.container.removeChild(c.canvas) : this.target.fastClear()
            }})
    }
    for (var k, l, m, n = 0, d = 0; d < b.length; d++) {
        var a = new Bitmap(R.poker, R.pokerbg.m), f = this.width - a.width >> 1, g = this.height - 220 - 5 * d, h = this.createCanvas("gamble" + d, {width: R.pokerbg.m[2], height: R.pokerbg.m[3], left: f, top: g}), e = new Stage(h.getContext("2d"));
        e.setFrameRate(0);
        e.addChildAt(a);
        this.container.appendChild(h);
        h.x = f;
        h.y = g;
        h.index = d;
        0 == d ? k = e : 1 == d ? l = e : m = e;
        f = 1 == d ? f - 45 : 2 == d ? f + 45 : f;
        g = this.height - 220;
        e =
            3E3 + 200 * d;
        setTimeout(TweenUtil.to, e, h, this.playTween ? 200 : 0, {x: f, y: g, onUpdate: function () {
            this.target.style.left = this.target.x + "px";
            this.target.style.top = this.target.y + "px"
        }, onComplete: function () {
            this.target.style.left = this.target.x + "px";
            this.target.style.top = this.target.y + "px";
            3 <= ++n && setTimeout(casual.delegate(ddz.startGamble, ddz), 500, [k, l, m], b)
        }})
    }
    var d = 0, p = setInterval(function () {
        if (17 <= d)clearInterval(p); else {
            ddz.players[0].pokers[d]._render(ddz.pokerStage.context);
            d++;
            for (var a = 1; 3 > a; a++) {
                var b =
                    ddz.players[a].pokerCount;
                b.fastClear(null, !0);
                UI.renderNumber(ddz.playerStage.context, b, d)
            }
        }
    }, 200)
};
