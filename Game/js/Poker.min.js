Poker=function(a,c,b){Sprite.call(this);this.point=a;this.type=c;this.size=b||"b";this.init()};casual.inherit(Poker,Sprite);
Poker.prototype.init=function(){this.selected=this.mouseChildren=!1;var a=new Bitmap(R.poker,R.pokerfg[this.size]);this.addChild(a);this.width=a.width;this.height=a.height;var c,b=R.pokerPoint[this.point][this.size];c=this.type==Poker.FANGKUAI||this.type==Poker.HONGTAO||17==this.point?b.r:b.b;var e=new Bitmap(R.poker,c);e.x=b.x;e.y=b.y;this.addChild(e);var e=R.pokerType[this.type.name][this.size],d=new Bitmap(R.poker,e.r);d.x=e.x;d.y=e.y;this.addChild(d);16>this.point&&"s"!=this.size&&(c=new Bitmap(R.poker,
c),c.scaleX=c.scaleY=-1,c.x=a.width-b.x,c.y=a.height-b.y-1,this.addChild(c),b=new Bitmap(R.poker,e.r),b.scaleX=b.scaleY=-1,b.x=a.width-e.x,b.y=a.height-e.y,this.addChild(b));"b"==this.size&&(a=new Shape,a.graphics.setSize(this.width,this.height),a.graphics.beginFill("#000").drawRoundRect(0,0,this.width,this.height,8).endFill(),a.alpha=0.3,this.mask=a)};Poker.prototype.setMask=function(a){a?this.addChild(this.mask):this.removeChild(this.mask)};
Poker.prototype.select=function(a){this.mouseEnabled&&this.selected!=a&&(this.selected=a,this.y+=this.selected?-12:12,ddz.onPokerSelect(this))};Poker.prototype.toString=function(){return this.point};Poker.shuffle=function(a){for(var c=0,b=a.length;c<b;c++){var e=Math.random()*(b-1)>>0,d=a[c];a[c]=a[e];a[e]=d}return a};
Poker.newPack=function(){for(var a=[],c=3;15>=c;c++)a.push(new Poker(c,Poker.FANGKUAI)),a.push(new Poker(c,Poker.MEIHUA)),a.push(new Poker(c,Poker.HONGTAO)),a.push(new Poker(c,Poker.HEITAO));a.push(new Poker(17,Poker.JOKERA));a.push(new Poker(16,Poker.JOKERB));return a};Poker.select=function(a,c){if(a instanceof Poker)a.select(c);else for(var b=0;b<a.length;b++)a[b].select(c)};Poker.TOTAL=54;Poker.START=3;Poker.END=17;
Poker.FANGKUAI={name:"fangkuai",rank:1,frame:[138,27,16,16],offsetX:0,offsetY:0,bmpdata:null};Poker.MEIHUA={name:"meihua",rank:2,frame:[122,27,16,16],offsetX:0,offsetY:0,bmpdata:null};Poker.HONGTAO={name:"hongtao",rank:3,frame:[128,13,16,14],offsetX:0,offsetY:0,bmpdata:null};Poker.HEITAO={name:"heitao",rank:4,frame:[166,27,16,16],offsetX:0,offsetY:0,bmpdata:null};Poker.JOKERA={name:"jokera",black:[199,59,29,66],red:[170,59,29,66],offsetX:20,offsetY:8};
Poker.JOKERB={name:"jokerb",black:[199,59,29,66],red:[170,59,29,66],offsetX:20,offsetY:8};Poker[3]={black:[90,27,10,14],red:[186,13,10,14],offsetX:1};Poker[4]={black:[206,13,10,14],red:[16,27,10,14],offsetX:1};Poker[5]={black:[176,13,10,14],red:[70,27,10,14],offsetX:1};Poker[6]={black:[60,27,10,14],red:[40,27,10,14],offsetX:1};Poker[7]={black:[78,13,10,14],red:[196,13,10,14],offsetX:1};Poker[8]={black:[0,13,10,14],red:[156,13,10,14],offsetX:1};Poker[9]={black:[6,27,10,14],red:[166,13,10,14],offsetX:1};
Poker[10]={black:[20,13,16,14],red:[216,13,16,14],offsetX:-2};Poker[11]={black:[246,13,8,14],red:[232,13,8,14],offsetX:0};Poker[12]={black:[154,27,12,16],red:[110,27,12,16],offsetX:0};Poker[13]={black:[144,13,12,14],red:[116,13,12,14],offsetX:0};Poker[14]={black:[50,13,14,14],red:[88,13,14,14],offsetX:-1};Poker[15]={black:[100,27,10,14],red:[50,27,10,14],offsetX:1};Poker[16]={black:[228,59,11,69],red:[228,59,11,69],offsetX:0};Poker[17]={black:[239,59,11,69],red:[239,59,11,69],offsetX:0};
Poker.createPokerBitmap=function(a,c){var b=new Poker(a,c),e=new Bitmap(Poker.image,Poker.foreground.b);b.addChild(e);b.width=e.width;b.height=e.height;var d=new Bitmap(Poker.image,Poker[b.point].frame);if(this.type==Poker.FANGKUAI||this.type==Poker.HONGTAO)d.frame=d.frame.slice(0),d.frame[1]+=20,trace(c,d.frame);d.x=6+Poker[b.point].offsetX;d.y=5;b.addChild(d);if(b.type!=Poker.JOKER){var f=new Bitmap(Poker.image,b.type.frame);f.x=4;f.y=22;b.addChild(f)}d=new Bitmap(Poker.image,d.frame);d.scaleX=
d.scaleY=-1;d.x=e.width-6;d.y=e.height-7;b.addChild(d);b.type!=Poker.JOKER&&(d=new Bitmap(Poker.image,b.type.frame),d.scaleX=d.scaleY=-1,d.x=e.width-5+Poker[b.point].offsetX,d.y=e.height-25,b.addChild(d));e=document.createElement("canvas");e.width=b.width;e.height=b.height;d=e.getContext("2d");b.render(d);return e};
